import { useState } from "react";

import { Direction, rotate } from "./space.js";

export function isInH2 (before, after) {
    const open = before.lastIndexOf("[");
    if (open < 0) return false;
    if (open < before.lastIndexOf("]")) return false;
    return true;
}

export function L ({ done, options }) {
    const [name, setName] = useState(null);
    const [dir, setDir] = useState([]);
    const [touch, setTouch] = useState(false);
    const fixDir = options.perspective == "obs" ?
        d => d :
        d => rotate(d);
    const finish = () => {
        const mod = dir.join('')+(touch?"*":"");
        if (name == "H2") {
            done((before, after) => [before+"[", "]"+mod+after, "Q"]);
        } else {
            done((name||"")+mod, "M")
        }
    };
    return <div className="grid grid-cols-[2fr,1fr,auto] grid-rows-[1fr,auto]">
        <svg className="w-full h-full col-start-1 col-end-3 row-start-1 row-end-4"
            viewBox="0 0 83 87">
            <defs>
                <filter id="svgblur">
                    <feGaussianBlur stdDeviation="0.6" />
                </filter>
            </defs>
            <g filter="url(#svgblur)">
                {area_paths.map(([thisName, thisDir, path]) => <AreaPath
                    key={thisName+thisDir}
                    name={thisName} dir={fixDir(thisDir)} path={path}
                    curName={name} curDir={dir}
                    setName={setName} setDir={setDir}
                />)}
            </g>
            <BodyOutline />
        </svg>
        <div className="col-start-2 col-end-4 row-start-1">
            <Direction val={dir} set={setDir} options={options} />
        </div>
        <button className={`col-start-3 row-start-2 mb-2 ${touch?"actual":""}`}
            onClick={() => setTouch(!touch)}>✳️</button>
        <button className="finish col-start-3 row-start-3 mr-2 mb-2"
            onClick={finish}>✔</button>
    </div>;
}

function AreaPath ({ name, dir, path, curName, setName, curDir, setDir }) {
    const isCur = name == curName &&
        ((!dir && curDir==null) || (curDir !== null && curDir[0] == dir) || (curDir == dir));
    const click = isCur ?
        () => { setName(null); setDir([]); } :
        () => { setName(name); setDir(dir?[dir]:[]); };
    return <path stroke="none" fill="none" d={path}
        onClick={click} className={`Locus ${isCur?"actual":''}`}
    />;
}

function BodyOutline() {
    return <path className="BodyOutline"
        fill="none"
        transform="translate(-20.038531,-49.396382)"
        d="m 65.786774,79.959739 c 0.352571,0.0755 0.721401,0.115571 1.101097,0.115571 2.511836,0 4.159713,-1.801395 4.159713,-3.964631 -10e-7,-1.997253 -1.456821,-3.606138 -3.700059,-3.847296 M 45.628492,84.293818 h 7.026058 m -3.513029,-9.841894 v 5.060765 m -16.595325,0.44705 c -0.352571,0.0755 -0.721401,0.115571 -1.101097,0.115571 -2.511836,0 -4.159713,-1.801395 -4.159713,-3.964631 1e-6,-1.997253 1.456821,-3.606138 3.700059,-3.847296 m 30.435826,-1.410447 c 0,1.304516 -1.944091,2.362035 -4.342248,2.362035 -2.398157,0 -4.342248,-1.057519 -4.342248,-2.362035 0,-1.304516 1.944091,-2.362035 4.342248,-2.362035 2.398157,0 4.342248,1.057519 4.342248,2.362035 z m -15.875004,0 c 0,1.304516 -1.944091,2.362035 -4.342248,2.362035 -2.398157,0 -4.342248,-1.057519 -4.342248,-2.362035 0,-1.304516 1.944091,-2.362035 4.342248,-2.362035 2.398157,0 4.342248,1.057519 4.342248,2.362035 z m -1.978366,19.03246 c 0,4.768154 -1.601817,5.09965 -1.601817,5.09965 -9.637633,1.903552 -16.723553,7.693474 -16.723553,14.538004 v 24.20956 m 9.070907,-21.06676 v 21.06676 m 38.727074,-24.20956 v 17.0953 h 14.304737 v -4.52418 c 0,-2.09149 2.553575,-2.11102 2.553575,0 v 2.89314 h 6.293234 c 6.403862,0 6.385782,8.74108 -1.639134,8.74108 l -30.60412,0.004 v -21.06676 m 9.091708,-3.14258 c 2e-6,-6.76312 -6.91835,-12.496561 -16.613496,-14.510985 0,0 -1.900484,-0.297573 -1.900484,-5.065727 M 67.223436,72.682297 c 0,9.986366 -8.095549,18.081915 -18.081915,18.081915 -9.986366,-10e-7 -18.081914,-8.095549 -18.081914,-18.081915 0,-9.986366 8.095548,-18.081914 18.081914,-18.081915 9.986366,0 18.081915,8.095549 18.081915,18.081915 z"/>
}

const area_paths = [
    ["Car", null, "M 45.752348,23.17885 A 16.517948,16.517948 0 0 1 29.2344,39.696799 16.517948,16.517948 0 0 1 12.716451,23.17885 16.517948,16.517948 0 0 1 29.2344,6.6609018 16.517948,16.517948 0 0 1 45.752348,23.17885 Z"],
    ["Cue", "X", "m 34.411106,40.761853 a 7.97424,2.7803014 0 0 1 -4.498241,0.614432 4.8848554,4.8850637 0 0 0 -0.858824,2.760556 4.8848554,4.8850637 0 0 0 4.884765,4.884973 4.8848554,4.8850637 0 0 0 4.467235,-2.920235 c -0.658242,-0.179351 -1.330215,-0.342874 -2.017879,-0.485759 0,0 -1.844849,-0.298477 -1.977056,-4.853967 z"],
    ["Cue", "Y", "m 23.663094,40.761853 a 7.9745802,2.7803014 0 0 0 4.498433,0.614432 4.8850637,4.8850637 0 0 1 0.858861,2.760556 4.8850637,4.8850637 0 0 1 -4.884973,4.884973 4.8850637,4.8850637 0 0 1 -4.467426,-2.920235 c 0.65827,-0.179351 1.330272,-0.342874 2.017964,-0.485759 0,0 1.844929,-0.298477 1.977141,-4.853967 z"],
    ["Hom", "X", "m 37.837482,45.952751 a 9.8086366,5.2541222 29.56827 0 0 -0.695047,0.818554 9.8086366,5.2541222 29.56827 0 0 5.938139,9.409761 9.8086366,5.2541222 29.56827 0 0 9.631452,1.580266 C 51.393584,52.380538 45.645678,47.932517 37.837482,45.952751 Z"],
    ["Hom", "Y", "m 20.236947,45.952751 a 5.2541222,9.8086366 60.43173 0 1 0.695047,0.818554 5.2541222,9.8086366 60.43173 0 1 -5.938139,9.409761 5.2541222,9.8086366 60.43173 0 1 -9.6314514,1.580266 C 6.6808456,52.380538 12.428751,47.932517 20.236947,45.952751 Z"],
    ["Bra", null, "m 53.001933,60.682084 c -3.030479,0.862306 -6.060956,1.724615 -9.091435,2.586921 0.03428,4.815554 0.06856,9.631111 0.102836,14.446665 3.729487,-0.134705 7.458977,-0.269407 11.188464,-0.404111 -0.04642,-0.203772 -0.462367,-0.0336 -0.655016,-0.0894 -0.514958,0 -1.029914,0 -1.544873,0 8e-6,-5.513359 1.6e-5,-11.026717 2.4e-5,-16.540075 z"],
    ["Ant", null, "m 53.001933,77.222159 c 0,2.370915 0,4.741828 0,7.112743 4.739418,-7.07e-4 9.478836,-0.0014 14.218253,-0.0021 0,-2.370225 0,-4.740452 0,-7.110677 -4.739417,1.6e-5 -9.478835,3.5e-5 -14.218253,5.1e-5 z"],
    ["Cod", null, "m 46.32172,77.401477 c -0.835623,0.02003 -1.786869,0.16609 -2.4722,0.604264 0,2.110065 0,4.22013 0,6.330195 2.699575,-3.36e-4 5.399153,-7.09e-4 8.098729,-0.0011 0.567991,-2.40175 -0.670973,-5.058312 -2.839789,-6.215282 -0.848527,-0.469691 -1.816933,-0.719222 -2.78674,-0.718119 z"],
    ["H2", null, "m 68.58341,71.121756 c -0.881608,-0.0078 -1.36098,0.945708 -1.276925,1.728695 0,1.457235 0,2.914473 0,4.371708 -0.341738,-0.102841 -0.31787,0.159924 -0.29714,0.419552 0,2.230374 0,4.460751 0,6.691125 2.68528,-0.009 5.371166,0.01693 8.056047,-0.01524 1.975032,-0.0819 4.095271,-0.872461 5.128738,-2.655927 0.946759,-1.541502 0.694913,-3.732432 -0.695377,-4.928219 -1.053582,-0.967055 -2.536847,-1.199073 -3.917379,-1.142743 -1.907013,0 -3.814027,0 -5.72104,0 -0.01556,-1.087583 0.03328,-2.178542 -0.02868,-3.26372 -0.08035,-0.627206 -0.577847,-1.220436 -1.24824,-1.205233 z"],
    ["Pec", "X", "m 45.255085,61.147762 a 9.5417404,9.5417404 0 0 1 -9.54174,9.541741 9.5417404,9.5417404 0 0 1 -9.541741,-9.541741 9.5417404,9.5417404 0 0 1 9.541741,-9.54174 9.5417404,9.5417404 0 0 1 9.54174,9.54174 z"],
    ["Pec", "Y", "m 31.167625,61.147762 a 9.5417404,9.5417404 0 0 1 -9.54174,9.541741 9.5417404,9.5417404 0 0 1 -9.54174,-9.541741 9.5417404,9.5417404 0 0 1 9.54174,-9.54174 9.5417404,9.5417404 0 0 1 9.54174,9.54174 z"],
    ["Tri", null, "M 39.656914,73.805847 A 10.537745,10.537745 0 0 1 29.119168,84.343593 10.537745,10.537745 0 0 1 18.581423,73.805847 10.537745,10.537745 0 0 1 29.119168,63.268102 10.537745,10.537745 0 0 1 39.656914,73.805847 Z"],
    ["Cad", "X", "m 38.656037,74.977852 c -4.933976,-0.16064 -9.415925,4.494572 -9.017002,9.358084 4.738383,0 9.476763,0 14.215147,0 0,-2.571247 0,-5.142494 0,-7.713741 -1.509332,-1.064763 -3.35093,-1.647889 -5.198145,-1.644343 z"],
    ["Cad", "Y", "m 19.418453,74.977852 c -1.752371,0.04299 -3.824045,0.498054 -5.09478,1.67795 0,2.560045 0,5.12009 0,7.680134 4.715302,0 9.430604,0 14.145906,0 0.187439,-3.853725 -2.401134,-7.623889 -6.058278,-8.848089 -0.959396,-0.337043 -1.975965,-0.510326 -2.992848,-0.509995 z"],
    ["Bar", null, "m 28.945519,36.577095 c -2.562448,0.04152 -5.790072,0.787683 -6.877099,3.407026 4.34992,1.842604 9.411424,1.903476 13.803809,0.165365 -0.926581,-2.750722 -4.370795,-3.526877 -6.92671,-3.572391 z"],
    ["Mej", "X", "m 38.611476,32.573214 a 4.2106431,7.0085095 42.949851 0 0 -2.191993,7.355099 18.445804,18.445804 0 0 0 5.880282,-4.217563 18.445804,18.445804 0 0 0 3.646092,-5.773467 4.2106431,7.0085095 42.949851 0 0 -7.334381,2.635931 z"],
    ["Mej", "Y", "m 19.462953,32.573214 a 7.0085095,4.2106431 47.050149 0 1 2.191993,7.355099 18.445804,18.445804 0 0 1 -5.880282,-4.217563 18.445804,18.445804 0 0 1 -3.646092,-5.773467 7.0085095,4.2106431 47.050149 0 1 7.334381,2.635931 z"],
    ["Cab", null, "M 28.935147,12.814888 C 26.372699,12.773368 18.807021,11.820278 17.719994,9.2009348 22.706141,4.0840396 33.843487,3.3721302 40.029883,8.8978775 39.103302,11.6486 31.491062,12.769374 28.935147,12.814888 Z"],
    ["Cab", "X", "M 39.18022,14.910839 A 7.0085095,4.2106431 49.544014 0 0 46.234942,17.93296 18.445804,18.445804 0 0 0 42.720547,11.607251 18.445804,18.445804 0 0 0 37.403978,7.3222781 7.0085095,4.2106431 49.544014 0 0 39.18022,14.910839 Z"],
    ["Cab", "Y", "m 18.894209,14.910839 a 4.2106431,7.0085095 40.455986 0 1 -7.054722,3.022121 18.445804,18.445804 0 0 1 3.514395,-6.325709 18.445804,18.445804 0 0 1 5.316569,-4.2849729 4.2106431,7.0085095 40.455986 0 1 -1.776242,7.5885609 z"],
    ["Ore", "X", "m 47.348012,22.96759 c 0.0037,2.912074 -0.725744,5.827146 -2.036566,8.409297 0.212706,-0.240446 0.202604,-0.846519 0.602575,-0.749594 0.984665,0.111318 2.022972,0.06595 2.923524,-0.387181 1.219205,-0.574516 2.063221,-1.833186 2.157087,-3.174563 0.121092,-1.217009 -0.379613,-2.492713 -1.359813,-3.241055 -0.650774,-0.513255 -1.466133,-0.788797 -2.286807,-0.856904 z"],
    ["Ore", "Y", "m 10.865015,22.96759 a 18.445804,18.445804 0 0 0 2.044319,8.404137 5.3026532,5.3661876 0 0 1 -0.0078,0.0052 c -0.129024,-0.252585 -0.255114,-0.506971 -0.373105,-0.76636 -0.416102,0.0282 -0.78509,0.06821 -1.164785,0.06821 -2.5118344,0 -4.1599534,-1.801379 -4.1599534,-3.964615 3e-6,-1.967154 1.415296,-3.554248 3.6612774,-3.746542 z"],
    ["Nar", null, "m 34.67077,27.433477 a 5.4290991,5.4290991 0 0 1 -5.429099,5.429099 5.4290991,5.4290991 0 0 1 -5.429099,-5.429099 5.4290991,5.4290991 0 0 1 5.429099,-5.429099 5.4290991,5.4290991 0 0 1 5.429099,5.429099 z"], 
    ["Boc", null, "m 37.091933,34.874306 a 8.1936769,2.5605254 0 0 1 -8.193677,2.560525 8.1936769,2.5605254 0 0 1 -8.193677,-2.560525 8.1936769,2.5605254 0 0 1 8.193677,-2.560526 8.1936769,2.5605254 0 0 1 8.193677,2.560526 z"],
    ["Ojo", "X", "m 42.219008,21.366301 a 5.2419844,2.9646056 0 0 1 -5.241984,2.964605 5.2419844,2.9646056 0 0 1 -5.241984,-2.964605 5.2419844,2.9646056 0 0 1 5.241984,-2.964606 5.2419844,2.9646056 0 0 1 5.241984,2.964606 z"],
    ["Ojo", "Y", "m 26.364831,21.400551 a 5.2419844,2.9646056 0 0 1 -5.241984,2.964605 5.2419844,2.9646056 0 0 1 -5.241985,-2.964605 5.2419844,2.9646056 0 0 1 5.241985,-2.964606 5.2419844,2.9646056 0 0 1 5.241984,2.964606 z"],
    ["Fre", null, "M 39.349368,12.820174 A 10.227102,4.4972953 0 0 1 29.122266,17.317468 10.227102,4.4972953 0 0 1 18.895164,12.820174 10.227102,4.4972953 0 0 1 29.122266,8.3228765 10.227102,4.4972953 0 0 1 39.349368,12.820174 Z"],
];
